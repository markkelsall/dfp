sap.ui.controller("application.viewWorkOrder",{onInit:function(){viewWorkOrderController=this;this.getView().addEventDelegate({onBeforeShow:function(a){viewWorkOrderController.onBeforeShow(a.data)}})},onBackPress:function(){workOrderApp.getNavigation().backPage()},onBeforeShow:function(a){console.log(a);if(a.action==="viewExisting"){var b=new sap.ui.model.json.JSONModel(a.workOrder);sap.ui.getCore().setModel(b,"currentWorkOrder")}else{if(a.action==="readNew"){oResponse={statusCode:200,data:referenceData.workOrders[a.workOrderNumber]};viewWorkOrderController.onReadNewWorkOrderCallback(oResponse)}}},onReadNewWorkOrderCallback:function(c){if(c===undefined||c===null||c.statusCode!==200||c.data===undefined||c.data===null){workOrderApp.getNavigation().backPage();return}var g=sap.ui.getCore().getModel("workOrderList").getData();g.data.push(c.data);var a=new sap.ui.model.json.JSONModel(g);sap.ui.getCore().setModel(a,"workOrderList");var f=new sap.ui.model.json.JSONModel(c.data);sap.ui.getCore().setModel(f,"currentWorkOrder");var e=new sap.ui.model.json.JSONModel({workOrderNumber:""});sap.ui.getCore().setModel(e,"newWorkOrder");var d=new sap.ui.model.json.JSONModel({date:new Date()});sap.ui.getCore().setModel(d,"editConfirmTime");var b=new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(b,"editConfirmTimeState")},onOperationItemPress:function(a){var b=a.getSource().getBindingContext("currentWorkOrder").getObject();var d=sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd/MM/YYYY"});b.date=d.parse(b.dateString,false);var c=new sap.ui.model.json.JSONModel(b);sap.ui.getCore().setModel(c,"editConfirmTime");if(!viewWorkOrderController.addConfirmTimeFragment){viewWorkOrderController.addConfirmTimeFragment=new sap.ui.xmlfragment("application.fragments.addConfirmTime",this)}viewWorkOrderController.addConfirmTimeFragment.open()},onSaveWorkOrderPress:function(){var a=sap.ui.getCore().getModel("currentWorkOrder").getData();oResponse={statusCode:200,data:a};viewWorkOrderController.onSaveWorkOrderCallback(oResponse)},onSaveWorkOrderCallback:function(a){if(a.statusCode!==200){sap.m.MessageToast.show("There was an error when trying to save your Work Order. Please try again.");return}sap.m.MessageToast.show("The Work Order has been saved.")},onAddCancelPress:function(){var a=new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(a,"editConfirmTimeState");var b=new sap.ui.model.json.JSONModel({date:new Date()});sap.ui.getCore().setModel(b,"editConfirmTime");viewWorkOrderController.addConfirmTimeFragment.close()},onAddConfirmPress:function(){var h=sap.ui.getCore().getModel("editConfirmTime").getData();var j=true;var e=sap.ui.getCore().getModel("editConfirmTimeState").getData();if(h===undefined||h===null){e.duration="Error";e.durationUnit="Error";e.postDate="Error";e.confirmationText="Error";j=false}if(h.duration===undefined||h.duration===""){e.duration="Error";j=false}else{e.duration="None"}if(h.unit==="u1"){$("#durationUnit").addClass("durationUnitErrorState");j=false}else{$("#durationUnit").removeClass("durationUnitErrorState")}if(h.date===undefined||h.date===null){e.date="Error";j=false}else{e.date="None"}if(h.confirmationText===undefined||h.confirmationText===""){e.confirmationText="Error";j=false}else{e.confirmationText="None"}if(!j){var c=new sap.ui.model.json.JSONModel(e);sap.ui.getCore().setModel(c,"editConfirmTimeState");return}for(var d=0;d<referenceData.units.length;d++){if(h.unitId===referenceData.units[d].id){h.unit=referenceData.units[d].text;break}}var b;if(h.date.getDate().toString().length===1){b="0"+h.date.getDate()}else{b=h.date.getDate()}var g;if(h.date.getMonth().toString().length===1){g="0"+(h.date.getMonth()+1)}else{g=(h.date.getMonth()+1)}h.dateString=b+"/"+g+"/"+h.date.getFullYear();var a=sap.ui.getCore().getModel("currentWorkOrder").getData();h.workCentre=a.workCentre;if(a.confirmedTime===undefined||a.confirmedTime===null){a.confirmedTime=[]}a.confirmedTime.push(h);var f=new sap.ui.model.json.JSONModel(a);sap.ui.getCore().setModel(f,"currentWorkOrder");referenceData.workOrders[a.workOrderNumber]=a;viewWorkOrderController.onAddCancelPress()},onTechnicallyCompleteWorkOrderPress:function(){if(!viewWorkOrderController.technicallyCompleteConfirmFragment){viewWorkOrderController.technicallyCompleteConfirmFragment=new sap.ui.xmlfragment("application.fragments.technicallyCompleteConfirm",this)}viewWorkOrderController.technicallyCompleteConfirmFragment.open()},onTechnicallyCompleteCancelPress:function(){viewWorkOrderController.technicallyCompleteConfirmFragment.close()},onTechnicallyCompleteConfirmPress:function(){var a=sap.ui.getCore().getModel("currentWorkOrder").getData();oResponse={statusCode:200,data:a};viewWorkOrderController.onTechnicallyCompleteWorkOrderCallback(oResponse)},onTechnicallyCompleteWorkOrderCallback:function(a){viewWorkOrderController.technicallyCompleteConfirmFragment.close();if(a.statusCode!==200){sap.m.MessageToast.show("There was an error when trying to technically complete your Work Order. Please try again.");return}sap.m.MessageToast.show("The Work Order has been technically completed.")}});